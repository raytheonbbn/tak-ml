openapi: 3.0.1
info:
  title: OpenAPI definition
  version: v0
servers:
- url: http://localhost:8234
  description: Generated server url
tags:
- name: Model Feedback
  description: API for adding model feedback
- name: Model Metrics
  description: API for Model Metrics
- name: Model Management
  description: API for managing TAK ML models
- name: Model Execution
  description: API for model inference execution with TAK ML models on server
paths:
  /v2/models/{MODEL_NAME}/versions/{MODEL_VERSION}/infer:
    post:
      tags:
      - Model Execution
      summary: Inference
      description: 'Performs inference using a specific version of a model. '
      operationId: postModelVersionInfer
      parameters:
      - name: MODEL_NAME
        in: path
        description: Name of the model
        required: true
        schema:
          type: string
      - name: MODEL_VERSION
        in: path
        description: Version of the model
        required: true
        schema:
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InferenceRequest'
        required: true
      responses:
        "200":
          description: Inference response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InferenceResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "404":
          description: Model or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InferenceResponse'
  /model_management/edit_model_wrapper/{modelHash}:
    post:
      tags:
      - Model Management
      summary: Edit or replace an existing TAKML model by model hash
      operationId: editModel
      parameters:
      - name: modelHash
        in: path
        required: true
        schema:
          type: string
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/EditTakmlModelWrapperRequest'
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /model_management/add_model_wrapper:
    post:
      tags:
      - Model Management
      summary: "Add a new TAKML model, returns id for TAK ML Model"
      operationId: addModel
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AddTakmlModelWrapperRequest'
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /model_feedback/add_feedback:
    post:
      tags:
      - Model Feedback
      summary: Add feedback to model
      operationId: addModelFeedback
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AddFeedbackRequest'
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /metrics/add_model_metrics:
    post:
      tags:
      - Model Metrics
      summary: Add Model Inference Metrics
      operationId: addModelMetrics
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddModelMetricsRequest'
        required: true
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /v2/models/{MODEL_NAME}/versions/{MODEL_VERSION}:
    get:
      tags:
      - Model Execution
      summary: Model Version Metadata
      description: 'Retrieves metadata for a specific version of a model. '
      operationId: getModelVersionMetadata
      parameters:
      - name: MODEL_NAME
        in: path
        description: Name of the model
        required: true
        schema:
          type: string
      - name: MODEL_VERSION
        in: path
        description: Version of the model
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Model version metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelMetadataResponse'
        "404":
          description: Model or version not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelMetadataResponse'
  /v2/models/{MODEL_NAME}/versions/{MODEL_VERSION}/ready:
    get:
      tags:
      - Model Execution
      summary: Model Version Ready
      description: 'The "model version ready" API indicates if a specific version
        of a model is ready for inference. '
      operationId: getModelVersionReady
      parameters:
      - name: MODEL_NAME
        in: path
        description: Name of the model
        required: true
        schema:
          type: string
      - name: MODEL_VERSION
        in: path
        description: Version of the model
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Model version is ready
        "404":
          description: Model or version not found
  /v2/health/ready:
    get:
      tags:
      - Model Execution
      summary: Server Ready
      description: 'The "server ready" API indicates if the inference server is ready
        to handle inference requests. This can be used for Kubernetes readiness probes. '
      operationId: getV2HealthReady
      responses:
        "200":
          description: Server is ready
        "503":
          description: Server is not ready
  /v2/health/live:
    get:
      tags:
      - Model Execution
      summary: Server Live
      description: 'The "server live" API indicates if the inference server is running
        and able to handle requests. This can be used for Kubernetes liveness probes. '
      operationId: getV2HealthLive
      responses:
        "200":
          description: Server is live
        "503":
          description: Server is not live
  /v2/:
    get:
      tags:
      - Model Execution
      summary: Server Metadata
      description: 'Retrieves metadata about the inference server. '
      operationId: getServerMetadata
      responses:
        "200":
          description: Server metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerMetadataResponse'
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /model_management/search:
    get:
      tags:
      - Model Management
      summary: Search Models
      operationId: searchModels
      parameters:
      - name: modelName
        in: query
        required: false
        schema:
          type: string
      - name: modelType
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                uniqueItems: true
                type: array
                items:
                  $ref: '#/components/schemas/IndexRow'
  /model_management/get_models:
    get:
      tags:
      - Model Management
      summary: Get metadata for all models
      operationId: getModels
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                uniqueItems: true
                type: array
                items:
                  $ref: '#/components/schemas/IndexRow'
  /model_management/get_model_metadata/{modelHash}:
    get:
      tags:
      - Model Management
      summary: Get metadata for a specific model by model hash
      operationId: getModelMetadata
      parameters:
      - name: modelHash
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/IndexRow'
  /model_management/get_model/{modelHash}:
    get:
      tags:
      - Model Management
      summary: Download a model binary by model hash
      operationId: downloadModel
      parameters:
      - name: modelHash
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: string
                format: byte
  /model_feedback/get_feedback:
    get:
      tags:
      - Model Feedback
      summary: Get all feedback for a model
      operationId: getFeedbackForModel
      parameters:
      - name: modelName
        in: query
        required: true
        schema:
          type: string
      - name: modelVersion
        in: query
        required: false
        schema:
          type: number
          format: double
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FeedbackResponse'
  /metrics/get_model_metrics:
    get:
      tags:
      - Model Metrics
      summary: Get Model Metrics
      operationId: getModelMetrics
      parameters:
      - name: modelName
        in: query
        required: true
        schema:
          type: string
      - name: modelVersion
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /metrics/get_model_inference_count:
    get:
      tags:
      - Model Metrics
      summary: Get Model Metrics
      operationId: getModelInferenceCounts
      parameters:
      - name: modelName
        in: query
        required: true
        schema:
          type: string
      - name: modelVersion
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /metrics/get_all_model_metrics:
    get:
      tags:
      - Model Metrics
      summary: Get All Model Metrics
      operationId: getAllModelMetrics
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ModelMetrics'
  /api/models/v2/get_models:
    get:
      tags:
      - model-management-controller-v-2
      summary: Get metadata for all models
      operationId: getModelDescriptors
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/IndexRow'
  /model_management/remove_model/{hash}:
    delete:
      tags:
      - Model Management
      summary: Remove a model by hash
      operationId: removeModel
      parameters:
      - name: hash
        in: path
        required: true
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
  /metrics/delete_model_metrics:
    delete:
      tags:
      - Model Metrics
      operationId: deleteModelMetrics
      parameters:
      - name: modelName
        in: query
        required: true
        schema:
          type: string
      - name: modelVersion
        in: query
        required: false
        schema:
          type: string
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: object
components:
  schemas:
    InferOutput:
      required:
      - data
      - datatype
      - name
      - shape
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        name:
          type: string
          description: Name of the output tensor
        shape:
          type: array
          description: Shape of the output tensor
          items:
            type: integer
            description: Shape of the output tensor
            format: int32
        datatype:
          type: string
          description: "Data type of the output tensor (e.g., \"FP32\", \"INT64\")"
        data:
          type: array
          description: Output data
          items:
            type: number
            description: Output data
      description: Output data from inference
    InferenceResponse:
      required:
      - model_name
      - outputs
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        model_name:
          type: string
          description: Name of the model
        model_version:
          type: string
          description: Version of the model
        id:
          type: string
          description: Unique identifier for the response
        outputs:
          type: array
          description: Output data from inference
          items:
            $ref: '#/components/schemas/InferOutput'
    Links:
      type: object
      additionalProperties:
        $ref: '#/components/schemas/Link'
    ErrorResponse:
      required:
      - error
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        error:
          type: string
          description: Error message
    InferInput:
      required:
      - data
      - datatype
      - name
      - shape
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        name:
          type: string
          description: Name of the input tensor
        shape:
          type: array
          description: Shape of the input tensor
          items:
            type: integer
            description: Shape of the input tensor
            format: int32
        datatype:
          type: string
          description: "Data type of the input tensor (e.g., \"FP32\", \"INT64\")"
        data:
          type: array
          description: Input data
          items:
            type: number
            description: Input data
      description: Input data for inference
    InferenceRequest:
      required:
      - inputs
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        id:
          type: string
          description: Unique identifier for the request
        inputs:
          type: array
          description: Input data for inference
          items:
            $ref: '#/components/schemas/InferInput'
      description: Inference request payload
    EditTakmlModelWrapperRequest:
      type: object
      properties:
        takmlModelWrapper:
          type: string
          format: binary
        requesterCallsign:
          type: string
        runOnServer:
          type: boolean
        supportedDevices:
          type: array
          items:
            type: string
    AddTakmlModelWrapperRequest:
      type: object
      properties:
        takmlModelWrapper:
          type: string
          format: binary
        requesterCallsign:
          type: string
        runOnServer:
          type: boolean
        supportedDevices:
          type: array
          items:
            type: string
    AddFeedbackRequest:
      required:
      - callsign
      - isCorrect
      - modelName
      - modelVersion
      - output
      type: object
      properties:
        modelName:
          type: string
        modelVersion:
          type: number
          format: double
        callsign:
          maxLength: 64
          minLength: 0
          type: string
        inputText:
          type: string
        inputFile:
          type: string
          format: binary
        output:
          type: string
        isCorrect:
          type: boolean
        outputErrorType:
          type: string
          enum:
          - FALSE_POSITIVE
          - FALSE_NEGATIVE
          - INCORRECT_LABEL
          - MISSING_LABEL
          - OTHER
        evaluationConfidence:
          maximum: 5
          minimum: 1
          type: integer
          format: int32
        evaluationRating:
          maximum: 5
          minimum: 1
          type: integer
          format: int32
        comment:
          type: string
        validInput:
          type: boolean
    AddModelMetricsRequest:
      type: object
      properties:
        requestId:
          type: string
        modelName:
          type: string
        modelVersion:
          type: number
          format: double
        deviceMetadata:
          $ref: '#/components/schemas/DeviceMetadata'
        inferenceMetrics:
          type: array
          items:
            $ref: '#/components/schemas/InferenceMetric'
    DeviceMetadata:
      type: object
      properties:
        model:
          type: string
        brand:
          type: string
        manufacturer:
          type: string
        device:
          type: string
        product:
          type: string
        gpuInfo:
          $ref: '#/components/schemas/GpuInfo'
    GpuInfo:
      type: object
      properties:
        vendor:
          type: string
        renderer:
          type: string
        version:
          type: string
    InferenceMetric:
      type: object
      properties:
        startMillis:
          type: integer
          format: int64
        durationMillis:
          type: integer
          format: int64
        confidence:
          type: number
          format: float
    ModelMetadataResponse:
      required:
      - inputs
      - name
      - outputs
      - platform
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        name:
          type: string
          description: Name of the model
        versions:
          type: array
          description: Available versions of the model
          items:
            type: string
            description: Available versions of the model
        platform:
          type: string
          description: "Platform/framework of the model (e.g., \"TensorFlow\", \"\
            PyTorch\")"
        inputs:
          type: array
          description: Input tensors for the model
          items:
            $ref: '#/components/schemas/ModelTensor'
        outputs:
          type: array
          description: Output tensors for the model
          items:
            $ref: '#/components/schemas/ModelTensor'
    ModelTensor:
      required:
      - datatype
      - name
      - shape
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        name:
          type: string
          description: Name of the tensor
        datatype:
          type: string
          description: "Data type of the tensor (e.g., \"FP32\", \"INT64\")"
        shape:
          type: array
          description: Shape of the tensor
          items:
            type: integer
            description: Shape of the tensor
            format: int32
      description: Output tensors for the model
    ServerMetadataResponse:
      required:
      - extensions
      - name
      - version
      type: object
      properties:
        _links:
          $ref: '#/components/schemas/Links'
        name:
          type: string
          description: Name of the server
        version:
          type: string
          description: Version of the server
        extensions:
          type: array
          description: Supported extensions
          items:
            type: string
            description: Supported extensions
    IndexRow:
      type: object
      properties:
        hash:
          type: string
        name:
          type: string
        additionalMetadata:
          type: object
          additionalProperties:
            type: string
        timeMillisToCallsign:
          type: object
          additionalProperties:
            type: string
        optionalSegments:
          type: object
          additionalProperties:
            type: string
    FeedbackResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        modelName:
          type: string
        modelVersion:
          type: number
          format: double
        callsign:
          type: string
        inputType:
          type: string
          enum:
          - TEXT
          - IMAGE
          - AUDIO
          - OTHER
        input:
          type: string
        output:
          type: string
        isCorrect:
          type: boolean
        outputErrorType:
          type: string
          enum:
          - FALSE_POSITIVE
          - FALSE_NEGATIVE
          - INCORRECT_LABEL
          - MISSING_LABEL
          - OTHER
        evaluationConfidence:
          type: integer
          format: int32
        evaluationRating:
          type: integer
          format: int32
        comment:
          type: string
        createdAt:
          type: string
          format: date-time
    ModelMetrics:
      type: object
      properties:
        id:
          $ref: '#/components/schemas/ModelMetricsId'
        inferenceMetricList:
          type: array
          items:
            $ref: '#/components/schemas/InferenceMetric'
        modelName:
          type: string
        modelVersion:
          type: number
          format: double
    ModelMetricsId:
      type: object
      properties:
        modelName:
          type: string
        modelVersion:
          type: number
          format: double
    Link:
      type: object
      properties:
        href:
          type: string
        hreflang:
          type: string
        title:
          type: string
        type:
          type: string
        deprecation:
          type: string
        profile:
          type: string
        name:
          type: string
        templated:
          type: boolean
